export default function createTgaBuffer(width, height, pixels, dontFlipY) {
  console.log('createTgaBuffer');

  const data = [
    0x2e, 0x01, 0x09, 0x00,
    0x00, 0x00, 0x01, 0x20,

    0x00, 0x00, 0x00, 0x00,
    width & 0xFF, width >> 8, height & 0xFF, height >> 8,

    0x08, 0x20, 0x53, 0x4f,
    0x4d, 0x48, 0x18, 0x00,

    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,

    0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00,
  ];

  // TODO proper color quantization
  for (let i = 0; i < 0x100; i++) {
    data.push(i, i, i, 0xFF);
  }

  for (let i = 0; i < width * height; i++) {
    //"rle" my ass
    const base = i * 3;
    const r = pixels[base];
    const g = pixels[base + 1];
    const b = pixels[base + 2];
    const grayscale = Math.floor((r + g + b) / 3);
    data.push(0x80);
    data.push(grayscale);
  }

  console.log(JSON.stringify(data));

  return new Uint8Array(data);
}
